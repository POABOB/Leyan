<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>打卡明細</title>
    <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/css/loading.css">
    <!-- <link rel="stylesheet" href="../assets/css/google.font.css"> -->
<link rel="stylesheet" href="../assets/css/style.css">
</head>
<style>
    p.font-black {
        color: black;
        font-weight: 400;
        line-height: 1rem;
        margin-bottom: 0;
        letter-spacing: 1px;
        padding: 3px 0;
    }
    .modal { overflow: auto !important; }
    .tr-space, .print{display: none;}
    @media print{
        body{-webkit-print-color-adjust: exact !important;}
        tbody tr:nth-child(odd) {background-color:#eee !important;}
    }
</style>
<body>
    <div class="loading-wrapper">
        <svg class="loading"><rect></rect></svg>
    </div>
    <div id='app'>
        <div class="wrapper"  >
            <!-- Sidebar -->
            <nav id="sidebar">
                <ul class="list-unstyled components">
                    <p>樂薪考勤系統 - <span v-text="user.clinic_name"></span></p>
                    <li><a href="./assistant.html">診所管理</a></li>
                    <li><a href="./announce.html">公告管理</a></li>
                    <li><a href="./employee.html">員工資料</a></li>
                    <li><a href="./closed_date.html">休診設定</a></li>
                    <li><a href="./position.html">崗位設定</a></li>
                    <li><a href="./shift_setting.html">班別設定</a></li>
                    <li v-show="user.right > 2"><a href="./salary_item.html">薪項名稱設定</a></li>
                    <li v-show="user.right > 2"><a href="./basic_salary.html">基本薪資設定</a></li></a></li>
                    <li><a href="./new_shift.html">新排班表</a></li>
                    <li  class="active"><a href="./shift_record.html">打卡明細</a></li>
                    <li><a href="./attendance_overtime.html">稽核明細</a></li>
                    <li><a href="./attendance_record.html">出勤明細</a></li>
                    <li><a href="./attendance_statistic.html">出勤統計表</a></li>
                    <li v-show="user.right > 2"><a href="./salary_calculation.html">每月薪資明細表</a></li>
                </ul>
            </nav>

            <!-- Page Content -->
            <div id="content">
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <div class="container-fluid">

                        <button type="button" id="sidebarCollapse" class="navbar-btn">
                            <span></span>
                            <span></span>
                            <span></span>
                        </button>
                        <button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                            <i class="fas fa-align-justify"></i>
                        </button>

                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="nav navbar-nav ml-auto">
                                <li class="nav-item" style="margin: auto;">
                                    <img width="25" height="25" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAACqklEQVRoge3Zy29NURTH8U/JNdGWgTCqBBOPxGtATEww8aom+hcYif/AY0oYMmLolRYzM48ZkWAiEdqiAxLvRrRGFa3Bvk33PbTncU+dRu43Wcm+95y19m+du8/aj0uLFi3KpIZeXMcAftRtANfq12qVqUuhB68wmWKvcKgijX9lAc5KF560M3XfykmK/4jj2ITFdduME/VrySQqpUejoD60z3J/B/oTPt1zrHFGFmkc831oy+DXhhuR35CKXuxejcNmtiefpAOfIv/DRUU08xL1RO3zQrnMyhguRJ8rqUqDpp/gxgL+myP/gRJ1ZWYsEpBn+EzRHvmPFRVRZR2O+54oI0he3kft1QX8Y58PRUU0k8DTqH2ggH/s86QJHYVJltGOHL6d+KyEMtoMNY0TWb/sE9lN82AiI9TveFlww+y/RKdG8RM4OMcaUzmjMYlPOIktQqlsr7dPaRw2kzhdgd4/WODPJNJsQhA/L5bTU3QL4zlN/JB5MGxmoiZUlKt4KcywY3iBK/Vr83ZL2aLF/0wXbmFU/tOHvDYqTHZdZYof+QfCkzZSVhK3KhA/ZTfLSCAeNtvKCJjC9qi/72k3Z1k9Tua8vwwy95llLRJv9/7FLJqrjywJjETtVfm0FCLX9jRLAs+i9u58WgqxJ2pfLCPgUdMv1VssKSPoDCzBu6i/PbPfno3FiaAPFDsHSqMdD6N+HmNhWcH34lcU/DV2lhW8Hut1FH8cW0uMD44JFSneVd3BPsWqUw37cTcR96ccpxR563o3LmF54vtR3MMjYfPyBl+FzUybMDyWYQ3WY4dQEDoTcb7gCG7n1JWL5cLualx5S4ZxXMaKuRSeZCXOYbgJ4cPCX1SFF21lLQ3WYRc2YK2Q3FLT1eoHvglleBDPcV9Fx+otWvxP/AYbWExd//xgHAAAAABJRU5ErkJggg=="/>
                                    {{user.name ? user.name : user.account_number}}
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" @click="logout()">登出</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
                <div>
                    
                    <div class="col-12 col-lg-6">
                        <div class="input-group mb-3">
                            <input type="date" class="form-control" id="startDate" v-model="filter.startDate">
                            <input type="date" class="form-control" id="endDate" v-model="filter.endDate">
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button" @click="getShiftRecord()" >確認</button>
                            </div>
                            <button class="btn btn-primary" type="button" data-toggle="modal" data-target="#shiftRecord">編輯紀錄</button>
                            <!-- <button class="btn btn-primary" @click="download(1)">csv匯出</button> -->
                            <button class="btn btn-primary" type="button" data-toggle="modal" data-target="#PDF">列印紀錄</button>
                            
                        </div>
                    </div>
                    <img style="display: none;" id="imgs" alt="">
                    <!-- <img src="../assets/img/transparent.jpg" class="watermark" > -->
                    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="pills-tab1" data-toggle="pill" href="#pills1" role="tab" aria-controls="pills1" aria-selected="true">打卡紀錄</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="pills-tab2" data-toggle="pill" href="#pills2" role="tab" aria-controls="pills2" aria-selected="false">簽到紀錄</a>
                        </li>
                    </ul>
                    <div class="tab-content" id="pills-tabContent">
                        <div class="tab-pane fade show active" id="pills1" role="tabpanel" aria-labelledby="pills1">
                            <div class="print">
                                <h2>打卡紀錄</h2>
                            </div>
                            <table class="table table-striped table-bordered">
                                <thead>
                                    <tr class="tr-space"><th colspan="50"><div class="space">&nbsp;</div></th></tr>
                                    <tr v-if="date.length===0"><th style="text-align: center;">日期範圍內無打卡資料</th></tr>
                                    <tr v-else>
                                        <th></th>
                                        <th v-for="(d, index) in date">{{d.date.slice(-2)}}({{d.day}})</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="(d,index) in list">
                                        <td class="btns">
                                            <button class="btn btn-outline-secondary" type="button" data-toggle="modal" data-target="#showThisEmployee"  @click="showThisEmployeeData(d.employee_id)">{{d.name}}</button>
                                        </td>
                                        <td v-for="(d2,index2) in d.record">
                                            <p v-for="(d3,index3) in d2.data" class="font-black">{{d3.datetime.slice(11,16)}}</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="tab-pane fade show" id="pills2" role="tabpanel" aria-labelledby="pills2">
                            <div class="print">
                                <h2>簽到紀錄</h2>
                            </div>
                            <table class="table table-striped  table-bordered">
                                <thead>
                                    <tr class="tr-space"><th colspan="50"><div class="space">&nbsp;</div></th></tr>
                                    <tr v-if="check_date.length===0"><th style="text-align: center;">日期範圍內無簽到資料</th></tr>
                                    <tr v-else>
                                        <th></th>
                                        <th v-for="(d, index) in check_date">{{d.date.slice(-2)}}({{d.day}})</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="(d,index) in check_list">
                                        <td class="btns">
                                            <button class="btn btn-outline-secondary" type="button" data-toggle="modal" data-target="#showThisEmployeeCheck"  @click="showThisEmployeeCheckData(d.employee_id)">{{d.name}}</button>
                                        </td>
                                        <td v-for="(d2,index2) in d.record">
                                            <p v-for="(d3,index3) in d2.data" class="font-black">{{d3.datetime.slice(11,16)}}</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    
                    
                    
                </div>
                
            </div>
        </div>
        <div class="modal fade" id="showThisEmployee" tabindex="-1" role="dialog" aria-labelledby="showThisEmployeeLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="showThisEmployeeLabel">員工打卡紀錄</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">日期</th>
                                    <th scope="col">員工名稱</th>
                                    <th scope="col">圖片路徑</th>
                                    <th scope="col">打卡時段</th>
                                </tr>
                            </thead>
                            <tbody>
                                    <tr v-for="(d, index) in employeeData">
                                        <td scope="row"><b>{{index + 1}}</b></td>
                                        <td>{{d.datetime}}</td>
                                        <td>{{d.name}}</td>
                                        <td>
                                            <div>
                                                <img width="100" height="75"  :src="'/api_v1.1/clinic/shift/record/img/'+d.record_id" alt=""><br>
                                            </div>
                                        </td>
                                        <td>{{getType(d.type)}}</td>
                                    </tr>
                                    <tr v-show="data == null || data.length < 1">
                                        <td colspan="12" style="text-align: center;">無打卡資料</td>
                                    </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="showThisEmployeeCheck" tabindex="-1" role="dialog" aria-labelledby="showThisEmployeeCheckLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="showThisEmployeeCheckLabel">員工簽到紀錄</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">日期</th>
                                    <th scope="col">員工名稱</th>
                                    <th scope="col">圖片路徑</th>
                                    <th scope="col">簽到類型</th>
                                </tr>
                            </thead>
                            <tbody>
                                    <tr v-for="(d, index) in employeeCheckData">
                                        <td scope="row"><b>{{index + 1}}</b></td>
                                        <td>{{d.datetime}}</td>
                                        <td>{{d.name}}</td>
                                        <td>
                                            <div>
                                                <img width="100" height="75"  :src="'/api_v1.1/clinic/shift/check/img/'+d.check_id" alt=""><br>
                                            </div>
                                        </td>
                                        <td>{{getCheckType(d.type)}}</td>
                                    </tr>
                                    <tr v-show="data == null || data.length < 1">
                                        <td colspan="12" style="text-align: center;">無簽到資料</td>
                                    </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                    </div>
                </div>
            </div>
        </div>


        <div class="modal fade" id="shiftRecord" tabindex="-1" role="dialog" aria-labelledby="shiftRecordLabel" aria-hidden="true" data-backdrop="static">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="shiftRecordLabel">編輯紀錄</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-6">
                                <label for="datetime">日期</label>
                                <select @change="filterShift()" v-model="form.date" class="form-control">
                                    <option value="0">請選擇日期</option>
                                    <option v-for="d in datetime" :value="d">{{ d }}</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label for="type">員工</label>
                                <select @change="filterShift()" v-model="form.employee_id" class="form-control">
                                    <option value="0">請選擇員工</option>
                                    <option v-for="d in employee_filter" :value="d.employee_id">{{ d.name }}</option>
                                </select>
                            </div>
                            <div class="col-12" v-show="tableShow">
                                <p class="text-center mt-3 font-black">
                                    {{ shift.name }}{{ shift.first ? ' - ' + shift.first : '' }}{{ shift.second ? ' - ' + shift.second : '' }}{{ shift.third ? ' - ' + shift.third : '' }}
                                </p>
                                <hr>
                                <h4>打卡紀錄</h4>
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th class="text-center">打卡時間</th>
                                            <th class="text-center">打卡類型</th>
                                            <th class="text-center">考勤狀態</th>
                                            <th class="text-center">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(d, i) in recordTable"  :style="{ background: showByShift(i) ? '' : '#eee' }" >
                                            <td class="text-center">{{ (d.record_id !== undefined) ? d.datetime : '無' }}</td>
                                            <td class="text-center">{{ shiftType(d.type) }}</td>
                                            <td class="text-center">{{ ((String(d.type)).length < 8) ? '' : showAttendanceStatus(d.type, d.over_time) }}</td>
                                            <td  class="text-center">
                                                <div v-if="d.datetime.length > 10">
                                                    <button @click="editShift(i, d.record_id)" class="btn btn-primary"  data-toggle="modal" data-target="#editRecord">編輯</button>
                                                    <button @click="deleteShift(d.record_id)" class="btn btn-primary">刪除</button>
                                                </div>
                                                <div v-else>
                                                    <div v-show="showByShift(i)">
                                                        <button @click="formType(i)" class="btn btn-primary"  data-toggle="modal" data-target="#addRecord">新增</button>
                                                    </div>
                                                    
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <h4>簽到紀錄</h4>
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th class="text-center">簽到時間</th>
                                            <th class="text-center">簽到類型</th>
                                            <th class="text-center">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(d, i) in checkTable">
                                            <td class="text-center">{{ (d.check_id !== undefined) ? d.datetime : '無' }}</td>
                                            <td class="text-center">{{ shiftType(d.type) }}</td>
                                            <td  class="text-center">
                                                <div v-if="d.datetime.length > 10">
                                                    <button @click="editCShift(i, d.check_id)" class="btn btn-primary"  data-toggle="modal" data-target="#editCheck">編輯</button>
                                                    <button @click="deleteCShift(d.check_id)"  class="btn btn-primary">刪除</button>
                                                </div>
                                                <div v-else>
                                                    <button @click="formType(i)" class="btn btn-primary"  data-toggle="modal" data-target="#addCheck">新增</button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="addRecord" tabindex="-1" role="dialog" aria-labelledby="addRecordLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addRecordLabel">新增打卡紀錄</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="time">打卡時間</label>
                            <input v-model="addForm.datetime" type="time" class="form-control">
                        </div>
                        <div class="form-check-inline">
                            <input @change="over_timeReset()" v-model="addForm.type" name="radioAR" value="0" class="form-check-input" type="radio" checked>
                            <label class="form-check-label" for="radios1">正常打卡</label>
                        </div>
                        <div class="form-check-inline">
                            <input @change="over_timeReset()" v-model="addForm.type" name="radioAR" value="o2" class="form-check-input" type="radio">
                            <label v-if="form.type.slice(0, 3) === 'on'" class="form-check-label" for="radio3">早到</label>
                            <label v-else class="form-check-label" for="radio3">加班</label>
                        </div>
                        <div class="form-check-inline" v-if="form.type.slice(0, 3) === 'off'">
                            <input @change="over_timeReset()" v-model="addForm.type" name="radioAR"value="e2" class="form-check-input" type="radio">
                            <label class="form-check-label" for="radios2">早退</label>
                        </div>
                        <div class="form-group">
                            <label for="over_time">分鐘數</label>
                            <input :disabled="over_timeAInput" v-model="addForm.over_time" type="number" min="0" required class="form-control">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                        <button @click="addShift()" type="button" class="btn btn-primary">新增</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="editRecord" tabindex="-1" role="dialog" aria-labelledby="editRecordLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editRecordLabel">編輯打卡紀錄</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="time">打卡時間</label>
                            <input v-model="updateForm.datetime" type="time" class="form-control">
                        </div>
                        <div class="form-check-inline">
                            <input @change="over_timeReset()" v-model="updateForm.type" name="radioUR" value="0" class="form-check-input" type="radio" checked>
                            <label class="form-check-label" for="radios1">正常打卡</label>
                        </div>
                        <div class="form-check-inline">
                            <input @change="over_timeReset()" v-model="updateForm.type" name="radioUR" value="o2" class="form-check-input" type="radio">
                            <label v-if="form.type.slice(0, 3) === 'on'" class="form-check-label" for="radio3">早到</label>
                            <label v-else class="form-check-label" for="radio3">加班</label>
                        </div>
                        <div class="form-check-inline" v-if="form.type.slice(0, 3) === 'off'">
                            <input @change="over_timeReset()" v-model="updateForm.type" name="radioUR"value="e2" class="form-check-input" type="radio">
                            <label class="form-check-label" for="radios2">早退</label>
                        </div>
                        <div class="form-group">
                            <label for="over_time">分鐘數</label>
                            <input  :disabled="over_timeUInput" v-model="updateForm.over_time" type="number" min="0" required class="form-control">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                        <button @click="updateShift()" type="button" class="btn btn-primary">更新</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="addCheck" tabindex="-1" role="dialog" aria-labelledby="addCheckLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addCheckLabel">新增簽到紀錄</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="time">打卡時間</label>
                            <input v-model="addCForm.datetime" type="time" class="form-control">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                        <button @click="addCShift()" type="button" class="btn btn-primary">新增</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="editCheck" tabindex="-1" role="dialog" aria-labelledby="editCheckLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editCheckLabel">編輯簽到紀錄</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="time">打卡時間</label>
                            <input v-model="updateCForm.datetime" type="time" class="form-control">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                        <button @click="updateCShift()" type="button" class="btn btn-primary">更新</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="PDF" tabindex="-1" role="dialog" aria-labelledby="PDFLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="PDFLabel">列印紀錄</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group" style="text-align: center;">
                            <div class="form-check form-check-inline">
                                <input v-model="printType" value="pills1" type="radio" class="form-check-input" name="radio" id="r1">
                                <label class="form-check-label" for="r1">打卡紀錄</label>
                              </div>
                              <div class="form-check form-check-inline">
                                <input v-model="printType" value="pills2" type="radio" class="form-check-input" name="radio"  id="r2">
                                <label class="form-check-label" for="r2">簽到紀錄</label>
                              </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                        <button @click="printPDF()" type="button" class="btn btn-primary">列印</button>
                    </div>
                </div>
            </div>
        </div>


        <iframe id="hidden-table" name="hidden-table" style="display: none;"></iframe>
    </div>



    <script src="../assets/js/loading.js"></script>
    <script src="../assets/js/jquery-3.4.1.min.js" ></script>
    <script src="../assets/js/q.js"></script>
    <script src="../assets/js/popper.min.js"></script>
    <script src="../assets/js/bootstrap.min.js"></script>
    <script src="../assets/js/vue.js"></script>
    <script src="../assets/js/moment.js"></script>
    <script src="../assets/js/xlsx.full.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#sidebarCollapse').on('click', function () {
                $('#sidebar').toggleClass('active');
                $(this).toggleClass('active');
            });

        });

        new Vue({
            el: "#app",
            data: {
                filter: {
                    month: '0000-00',
                    startDate: '0000-00-00',
                    endDate: '0000-00-00',
                },
                data: [],
                check_data: [],
                date:[],
                check_date:[],
                employee: [],
                check_employee: [],
                type: {
                    "on_1st":  "第一班上班",
                    "off_1st": "第一班下班",
                    "on_2nd": "第二班上班",
                    "off_2nd": "第二班下班",
                    "on_3rd": "第三班上班",
                    "off_3rd": "第三班下班"
                },
                checkType: {
                    "on_1st":  "簽到",
                    "off_1st": "簽退"
                },
                day_list: ['日', '一', '二', '三', '四', '五', '六'],
                list: [],
                check_list: [],
                employeeData: [],
                employeeCheckData: [],
                times:0,
                datetime:[],
                employee_filter:[],
                shiftTable: [],
                recordTable:[],
                checkTable:[],
                shift: {
                    name: '',
                    first: '',
                    second: '',
                    third: '',
                },
                tableShow: false,
                form: {
                    date: 0,
                    employee_id: 0,
                    type: '',
                },
                over_timeAInput: true,
                over_timeUInput: true,
                addForm: {
                    datetime: '',
                    employee_id: 0,
                    type: '0',
                    over_time: 0
                },
                updateForm: {
                    datetime: '',
                    type: '0',
                    over_time: 0,
                    record_id: 0
                },
                addCForm: {
                    datetime: '',
                    employee_id: 0,
                    type: ''
                },
                updateCForm: {
                    datetime: '',
                    type: '',
                    check_id: 0
                },
                user: {
                    user_id: 0,
                    account_number: '',
                    right: 0,
                    clinic_id: 0,
                    clinic_name:''
                },
                chineseNumber: {
                    0: '零',
                    1: '一',
                    2: '二',
                    3: '三',
                },
                printType: 'pills1'
            },
            created() {
                //日期調整
                this.filter.month = new Date().Format('yyyy-MM')
                this.filter.startDate = new Date(this.filter.month).Format('yyyy-MM-01')
                this.filter.endDate = new Date(this.filter.month.slice(0,4), this.filter.month.slice(-2), 0).Format('yyyy-MM-dd')
                get('/api_v1.1/info?token='+window.localStorage.getItem('token')).then(res => {
                    if(res.code == 403) {
                        window.localStorage.removeItem('token')
                        location.href = './index.html?redirect=shift_record.html'
                    } else {
                        this.user = res.data
                        this.getShiftRecord()
                    }
                })
            },
            mounted() {
                //iframe 建立boostrap css
                let link = document.createElement("link") 
                link.href = "../assets/css/bootstrap.min.css"; 
                link.rel = "stylesheet"; 
                link.type = "text/css";
                window.frames['hidden-table'].document.head.appendChild(link);
                
                const style = "@page { size:  auto; margin: 10px 5px;}body {margin: 0 5px;font-family: Arial;font-size: 10px;-webkit-print-color-adjust:exact;}.page{min-height:100vh;display:flex;flex-direction:column}td.btns{vertical-align: middle !important;}p{margin-bottom: 0.2rem !important;}table td{padding: .3rem .1rem !important;text-align:center;}table tr{page-break-inside:avoid !important;}div.print{display: block; position: fixed;top: 1rem;left:50%;transform: translateX(-50%);}thead { display: table-header-group; }tfoot { display: table-row-group }tr { page-break-inside: avoid }.space{height:2.5rem;}tr th{text-align:center;}tbody tr:nth-child(odd) td {background-color:#eee !important;}"
                let link3 = document.createElement("style")
                link3.appendChild(document.createTextNode(style));
                window.frames['hidden-table'].document.head.appendChild(link3);
            },
            methods: {
                logout() {
                    get('/api_v1.1/logout').then(res => {
                        if (res.code === 200) {
                            window.localStorage.removeItem('token')
                            alert('success')
                            location.href = './index.html'
                            return
                        }
                        else {
                            alert(res.message)
                        }
                    })
                },
                getShiftRecord() {
                    get('/api_v1.1/clinic/shift/record?start='+this.filter.startDate+'&end='+this.filter.endDate).then(res => {
                        let tmp = res.data[0]
                        // this.data = tmp.sort((a, b) => new Date(a.datetime) - new Date(b.datetime))
                        this.data = ArraySort(tmp, (a, b) => new Date(a.datetime) - new Date(b.datetime))
                        this.date = []
                        res.data[1].forEach(item => {
                            this.date.push({date: item[0], day: this.checkDay(item[0]), data: []})
                        })
                        //外層是object，轉成array
                        this.employee = Object.values(res.data[2])
                        //check
                        tmp = res.data[3]
                        // this.check_data = tmp.sort((a, b) => new Date(a.datetime) - new Date(b.datetime))
                        this.check_data = ArraySort(tmp, (a, b) => new Date(a.datetime) - new Date(b.datetime))
                        this.check_date = []
                        res.data[4].forEach(item => {
                            this.check_date.push({date: item[0], day: this.checkDay(item[0]), data: []})
                        })
                        //外層是object，轉成array
                        this.check_employee = Object.values(res.data[5])
                        this.showAllRecord()
                        
                        //foreach startDate~endDate塞入陣列
                        let tmpDate = JSON.parse(JSON.stringify(this.filter.startDate))
                        let tmpDatetime = []
                        while((Date.parse(tmpDate)).valueOf() <= (Date.parse(this.filter.endDate)).valueOf()) {
                            tmpDatetime.push(tmpDate)
                            tmpDate = new Date(new Date(tmpDate).setDate(new Date(tmpDate).getDate()+1)).Format('yyyy-MM-dd')
                        }
                        this.datetime = tmpDatetime
                        this.shiftTable = res.data[6]
                        this.employee_filter = res.data[7]
                        this.filterShift()
                        this.$nextTick()
                    })
                },
                showAllRecord() {
                    this.list = []
                    const format = {
                        employee_id: 0,
                        name: '',
                        record: []
                    }
                    //建立list
                    this.employee.forEach(item => {
                        let tmp = JSON.parse(JSON.stringify(format))
                        //員工不重複資料
                        tmp.employee_id = item.employee_id
                        tmp.name = item.name

                        //日期不重複資料
                        tmp.record = JSON.parse(JSON.stringify(this.date))

                        //依據data來賦予該list資料
                        let d = this.data.filter(d => d.employee_id == tmp.employee_id)                        
                        d.forEach(item => {
                            for(let item2 of tmp.record) {
                                this.times+=1
                                if (item2.date !== item.datetime.slice(0, 10)) {
                                    continue;
                                } else {
                                    item2.data.push(item)
                                }
                            }
                        })
                        this.list.push(tmp)
                    })
                    //check
                    this.check_employee.forEach(item => {
                        let tmp = JSON.parse(JSON.stringify(format))
                        //員工不重複資料
                        tmp.employee_id = item.employee_id
                        tmp.name = item.name

                        //日期不重複資料
                        tmp.record = JSON.parse(JSON.stringify(this.check_date))

                        //依據data來賦予該list資料
                        let d = this.check_data.filter(d => d.employee_id == tmp.employee_id)                        
                        d.forEach(item => {
                            for(let item2 of tmp.record) {
                                this.times+=1
                                if (item2.date !== item.datetime.slice(0, 10)) {
                                    continue;
                                } else {
                                    item2.data.push(item)
                                }
                            }
                        })
                        this.check_list.push(tmp)
                    })
                },
                showThisEmployeeData(employee_id) {
                    this.employeeData = this.data.filter(d => d.employee_id === employee_id)
                },
                showThisEmployeeCheckData(employee_id) {
                    this.employeeCheckData = this.check_data.filter(d => d.employee_id === employee_id)
                },
                getRecord(id) {
                    return this.data.filter(data => data.employee_id == id)
                },
                getType(type) {
                    if(type.length < 8) {
                            //一般tag
                            return this.type[type]
                    } else if(type.slice(0,2) === 'on') {
                        //on帶o o2的tag
                        return this.type[type.slice(0,6)]
                    } else {
                        //off帶o o2的tag
                        return this.type[type.slice(0,7)]
                    }
                },
                getCheckType(type) {
                    return this.checkType[type]
                },
                checkDay(date) {
                    //判斷星期幾
                    return this.day_list[new Date(date).getDay()]
                },
                filterShift() {
                    //如果都被選擇，顯示資訊
                    if(parseInt(this.form.date) !== 0 && parseInt(this.form.employee_id) !== 0) {
                        //選出該員工當天排班及其時段
                        //獲取範圍內的shift
                        let shift = this.shiftTable.find(d => parseInt(d.employee_id) === parseInt(this.form.employee_id) &&
                                                    ((Date.parse(d.startDay)).valueOf() <= (Date.parse(this.form.date)).valueOf()
                                                    && (Date.parse(d.endDay)).valueOf() >= (Date.parse(this.form.date)).valueOf()))
                        let trueShift = {}                     
                        //準確獲取該日排班
                        if(shift !== undefined) {
                            trueShift = shift.data.find(d => d.date === this.form.date)
                            if(trueShift !== undefined) {
                                if(trueShift.shift.shift_name === '休假') {
                                    this.shift.name = '無排班'
                                } else {
                                    this.shift.name = trueShift.shift.shift_name
                                }
                                
                                if(trueShift.shift.on_1st !== undefined && trueShift.shift.off_1st !== undefined) {
                                    this.shift.first  = `第一班: ${trueShift.shift.on_1st} ~ ${trueShift.shift.off_1st}`
                                } else {
                                    this.shift.first = ''
                                }

                                if(trueShift.shift.on_2nd !== undefined && trueShift.shift.off_2nd !== undefined) {
                                    this.shift.second  = `第二班: ${trueShift.shift.on_2nd} ~ ${trueShift.shift.off_2nd}`
                                } else {
                                    this.shift.second = ''
                                }

                                if(trueShift.shift.on_3rd !== undefined && trueShift.shift.off_3rd !== undefined) {
                                    this.shift.third  = `第三班: ${trueShift.shift.on_3rd} ~ ${trueShift.shift.off_3rd}`
                                } else {
                                    this.shift.third = ''
                                }
                            }
                        } else {
                            this.shift.name = '無排班'
                            this.shift.first = ''
                            this.shift.second = ''
                            this.shift.third = ''
                        }
                        
                        this.recordTable = [];
                        this.checkTable = [];

                        //獲取打卡紀錄&簽到紀錄
                        const record = this.data.filter(d => 
                                                    d.datetime.substr(0, 10) === this.form.date &&
                                                    parseInt(d.employee_id) === parseInt(this.form.employee_id))
                        let i, r_index, c_index;
                        for(i = 0; i < 6; i++) {
                            r_index = (i / 2) + 1;
                            if(i % 2 === 0) {
                                const single = record.find(d => parseInt(d.type.substr(3, 1)) === parseInt(r_index))
                                //on
                                if(single !== undefined) {
                                    this.recordTable.push({
                                        type: single.type,
                                        datetime: single.datetime,
                                        employee_id: single.employee_id,
                                        over_time: single.over_time,
                                        record_id: single.record_id
                                    })
                                } else {
                                    this.recordTable.push({
                                        type: r_index,
                                        datetime: '',
                                        over_time: 0,
                                        employee_id: this.form.employee_id
                                    })
                                }
                            } else {
                                const single = record.find(d => parseInt(d.type.substr(4, 1)) === parseInt(r_index))
                                //off
                                if(single !== undefined) {
                                    this.recordTable.push({
                                        type: single.type,
                                        datetime: single.datetime,
                                        employee_id: single.employee_id,
                                        over_time: single.over_time,
                                        record_id: single.record_id
                                    })
                                } else {
                                    this.recordTable.push({
                                        type: r_index,
                                        datetime: '',
                                        over_time: 0,
                                        employee_id: this.form.employee_id
                                    })
                                }
                            }
                        }

                        const check = this.check_data.filter(d => 
                                                    d.datetime.substr(0, 10) === this.form.date &&
                                                    parseInt(d.employee_id) === parseInt(this.form.employee_id))
                        for(i = 0; i < 2; i++) {
                            c_index = (i / 2) + 1
                            if(i % 2 === 0) {
                                const single = check.find(d => parseInt(d.type.substr(3, 1)) === parseInt(c_index))
                                //on
                                if(single !== undefined) {
                                    this.checkTable.push({
                                        type: single.type,
                                        datetime: single.datetime,
                                        employee_id: single.employee_id,
                                        check_id: single.check_id
                                    })
                                } else {
                                    this.checkTable.push({
                                        type: c_index,
                                        datetime: '',
                                        employee_id: this.form.employee_id
                                    })
                                }
                            } else {
                                const single = check.find(d => parseInt(d.type.substr(4, 1)) === parseInt(c_index))
                                //off
                                if(single !== undefined) {
                                    this.checkTable.push({
                                        type: single.type,
                                        datetime: single.datetime,
                                        employee_id: single.employee_id,
                                        check_id: single.check_id
                                    })
                                } else {
                                    this.checkTable.push({
                                        type: c_index,
                                        datetime: '',
                                        employee_id: this.form.employee_id
                                    })
                                }
                            }
                        }
                        this.tableShow = true
                    } else {
                        this.tableShow = false
                    }
                },
                shiftType(type = 1) {
                    if((String(type)).substr(0, 2) === 'on') {
                        return `第${this.chineseNumber[parseInt(type.substr(3, 1))]}班 上班`
                    } else if((String(type)).substr(0, 3) === 'off') {
                        return `第${this.chineseNumber[parseInt(type.substr(4, 1))]}班 下班`
                    } else {
                        if(type % 1 === 0) {
                            return `第${this.chineseNumber[parseInt(type)]}班 上班`
                        } else {
                            return `第${this.chineseNumber[parseInt(type)]}班 下班`
                        }
                    }
                },
                showByShift(i) {
                    if(this.shift.name === '無排班') {
                        return true
                    } else {
                        const index = parseInt(parseInt(i) / 2 + 1);
                        if(index === 1) {
                            return (this.shift.first.length > 0) ? true : false
                        } else if(index === 2) {
                            return (this.shift.second.length > 0) ? true : false
                        } else {
                            return (this.shift.third.length > 0) ? true : false
                        }
                    }
                },
                showAttendanceStatus(type, over_time) {
                    if(type.slice(0, 3) === 'off') {
                        //判斷早退 還是加班
                        if(type.slice(8,10) === 'o2' || type.slice(8,10) === 'o') {
                            return `加班 ${over_time} 分鐘`
                        } else {
                            return `早退 ${over_time} 分鐘`
                        }
                    } else {
                        return `早到 ${over_time} 分鐘`
                    }
                },
                formType(i) {
                    const index = parseInt(parseInt(i) / 2 + 1);
                    if(index === 1) {
                        if(i % 2 === 0) {
                            this.form.type = "on_1st"
                        } else {
                            this.form.type = "off_1st"
                        }
                    } else if(index === 2) {
                        if(i % 2 === 0) {
                            this.form.type = "on_2nd"
                        } else {
                            this.form.type = "off_2nd"
                        }
                    } else {
                        if(i % 2 === 0) {
                            this.form.type = "on_3rd"
                        } else {
                            this.form.type = "off_3rd"
                        }
                    }
                },
                addShift() {
                    let add = {
                        employee_id: this.form.employee_id,
                        datetime: `${this.form.date} ${this.addForm.datetime}:00`,
                        over_time: this.addForm.over_time,
                        type: this.form.type + ((this.addForm.type != "0") ? `_${this.addForm.type}` : '')
                    }
                    post('/api_v1.1/clinic/shift/record/add', add).then(res => {
                        alert(res.message)
                        if(res.code == 403) {
                            location.href = './index.html'
                        } else if(res.code == 200) {
                            //重新獲取打卡/簽到資料
                            this.getShiftRecord()
                            this.filterShift()
                            $('#addRecord').modal('hide')
                            this.$nextTick()
                        }
                    })
                },
                editShift(i, record_id) {
                    const shift = this.recordTable.find(d => parseInt(d.record_id) === parseInt(record_id))
                    let type
                    if(shift.type.slice(-2) === "o2" || shift.type.slice(-2) === "e2") {
                        type = shift.type.slice(-2)
                    } else {
                        type = "0"
                    }
                    this.updateForm.datetime = shift.datetime.slice(11, 16)
                    this.updateForm.type = type
                    this.updateForm.over_time = shift.over_time
                    this.updateForm.record_id = record_id
                    this.formType(i)
                    this.over_timeReset()
                },
                updateShift() {
                    let update = {
                        employee_id: this.form.employee_id,
                        datetime: `${this.form.date} ${this.updateForm.datetime}:00`,
                        over_time: this.updateForm.over_time,
                        type: this.form.type + ((this.updateForm.type != 0) ? `_${this.updateForm.type}` : ''),
                        record_id: this.updateForm.record_id
                    }
                    post('/api_v1.1/clinic/shift/record/update', update).then(res => {
                        alert(res.message)
                        if(res.code == 403) {
                            location.href = './index.html'
                        } else if(res.code == 200) {
                            //重新獲取打卡/簽到資料
                            this.getShiftRecord()
                            this.filterShift()
                            $('#editRecord').modal('hide')
                            this.$nextTick()
                        }
                    })
                },
                deleteShift(record_id) {
                    let form = {
                        record_id: record_id,
                        employee_id: this.form.employee_id
                    }
                    if(confirm('刪除後則無法復原，確定要刪除該筆紀錄?')) {
                        post('/api_v1.1/clinic/shift/record/delete', form).then(res => {
                            alert(res.message)
                            if(res.code == 403) {
                                location.href = './index.html'
                            } else if(res.code == 200) {
                                //重新獲取打卡/簽到資料
                                this.getShiftRecord()
                                this.filterShift()
                                this.$nextTick()
                            }
                        })
                    }
                },
                addCShift() {
                    let add = {
                        employee_id: this.form.employee_id,
                        datetime: `${this.form.date} ${this.addCForm.datetime}:00`,
                        type: this.form.type
                    }
                    post('/api_v1.1/clinic/shift/check/add', add).then(res => {
                        alert(res.message)
                        if(res.code == 403) {
                            location.href = './index.html'
                        } else if(res.code == 200) {
                            //重新獲取打卡/簽到資料
                            this.getShiftRecord()
                            this.filterShift()
                            $('#addCheck').modal('hide')
                            this.$nextTick()
                        }
                    })
                },
                editCShift(i, check_id) {
                    this.formType(i)
                    const shift = this.checkTable.find(d => parseInt(d.check_id) === parseInt(check_id))
                    this.updateCForm.datetime = shift.datetime.slice(11, 16)
                    this.updateCForm.check_id = check_id
                },
                updateCShift() {
                    let update = {
                        employee_id: this.form.employee_id,
                        datetime: `${this.form.date} ${this.updateCForm.datetime}:00`,
                        type: this.form.type,
                        check_id: this.updateCForm.check_id
                    }
                    post('/api_v1.1/clinic/shift/check/update', update).then(res => {
                        alert(res.message)
                        if(res.code == 403) {
                            location.href = './index.html'
                        } else if(res.code == 200) {
                            //重新獲取打卡/簽到資料
                            this.getShiftRecord()
                            this.filterShift()
                            $('#editCheck').modal('hide')
                            this.$nextTick()
                        }
                    })
                },
                deleteCShift(check_id) {
                    let form = {
                        check_id: check_id,
                        employee_id: this.form.employee_id
                    }
                    if(confirm('刪除後則無法復原，確定要刪除該筆紀錄?')) {
                        post('/api_v1.1/clinic/shift/check/delete', form).then(res => {
                            alert(res.message)
                            if(res.code == 403) {
                                location.href = './index.html'
                            } else if(res.code == 200) {
                                //重新獲取打卡/簽到資料
                                this.getShiftRecord()
                                this.filterShift()
                                this.$nextTick()
                            }
                        })
                    }
                },
                over_timeReset() {
                    if(this.addForm.type == "0") {
                        this.addForm.over_time = 0
                        this.over_timeAInput = true
                    } else {
                        this.over_timeAInput = false
                    }
                    if(this.updateForm.type == "0") {
                        this.updateForm.over_time = 0
                        this.over_timeUInput = true
                    } else {
                        this.over_timeUInput = false
                    }
                },
                download(type = 1) {
                    let data = [];
                    data.push([`打卡紀錄`])
                    //處理打卡
                    let tmp = [];

                    tmp.push(``);
                    this.date.forEach(d => {
                        tmp.push(`${d.date.slice(-2)}(${d.day})`);
                    });
                    data.push(tmp);
                    this.list.forEach(d => {
                        tmp = [];
                        //name
                        tmp.push(`${d.name}`);
                        //time
                        let tmp_time = ``;
                        d.record.forEach(d2 => {
                            tmp_time = ``;
                            d2.data.forEach((d3, index) => {
                                if(index > 0) {
                                    tmp_time += `\n${d3.datetime.slice(11,16)}`
                                } else {
                                    tmp_time += `${d3.datetime.slice(11,16)}`
                                }
                            });
                            tmp.push(tmp_time);
                        });
                        data.push(tmp);
                    });
                    
                    data.push([],[`簽到紀錄`])
                    ///處理簽到
                    tmp = [];
                    tmp.push(``);
                    this.check_date.forEach(d => {
                        tmp.push(`${d.date.slice(-2)}(${d.day})`)
                    })
                    data.push(tmp);
                    
                    this.check_list.forEach(d => {
                        tmp = [];
                        //name
                        tmp.push(`${d.name}`);
                        //time
                        let tmp_time_check = ``;
                        d.record.forEach(d2 => {
                            tmp_time_check = ``;
                            d2.data.forEach((d3, index) => {
                                if(index > 0) {
                                    tmp_time_check += `\n${d3.datetime.slice(11,16)}`
                                } else {
                                    tmp_time_check += `${d3.datetime.slice(11,16)}`
                                }
                            });
                            tmp.push(tmp_time_check);
                        });
                        data.push(tmp);
                    });
                    //export
                    if(parseInt(type) === 1) {
                        this.exportCSV(data);
                    } else {
                        this.printPDF();
                    }
                },
                exportCSV(rows = [], filename = `${this.filter.startDate}~${this.filter.endDate} 打卡/簽到紀錄.csv`) {
                    var processRow = function (row) {
                        var finalVal = '';
                        for (var j = 0; j < row.length; j++) {
                            var innerValue = row[j] === null ? '' : row[j].toString();
                            if (row[j] instanceof Date) {
                                innerValue = row[j].toLocaleString();
                            };
                            var result = innerValue.replace(/"/g, '""');
                            if (result.search(/("|,|\n)/g) >= 0)
                                result = '"' + result + '"';
                            if (j > 0)
                                finalVal += ',';
                            finalVal += result;
                        }
                        return finalVal + '\n';
                    };

                    var csvFile = '';
                    for (var i = 0; i < rows.length; i++) {
                        csvFile += processRow(rows[i]);
                    }

                    var blob = new Blob(["\ufeff" + csvFile], { type: 'text/csv;charset=utf-8;' });
                    if (navigator.msSaveBlob) { // IE 10+
                        navigator.msSaveBlob(blob, filename);
                    } else {
                        var link = document.createElement("a");
                        if (link.download !== undefined) { // feature detection
                            // Browsers that support HTML5 download attribute
                            var url = URL.createObjectURL(blob);
                            link.setAttribute("href", url);
                            link.setAttribute("download", filename);
                            link.style.visibility = 'hidden';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        }
                    }
                },
                printPDF() {
                    const printHTML = document.getElementById(this.printType).innerHTML;
                    var win = window.frames['hidden-table'];
                    if(this.printType === 'pills1') {
                        document.title = `${this.filter.startDate} ${this.filter.endDate}打卡紀錄`
                    } else {
                        document.title = `${this.filter.startDate} ${this.filter.endDate}簽到紀錄`
                    }
                    
                    // var win = window.open();
                    win.document.body.innerHTML = printHTML;
                    win.document.close();
                    win.print();
                    if(this.printType === 'pills1') {
                        document.title = `打卡紀錄`
                    } else {
                        document.title = `簽到紀錄`
                    }
                }
            },
            watch: {
                "filter.startDate": {
                    handler: function() {
                        //選取其他月分的話，要同步 start&end
                        if(this.filter.startDate.slice(0,7) !== this.filter.month) {
                            this.filter.month = this.filter.startDate.slice(0,7)
                            this.filter.endDate = new Date(this.filter.month.slice(0,4), this.filter.month.slice(-2), 0).Format('yyyy-MM-dd')
                        }
                        this.form = {date: 0, employee_id: 0, type: ''}
                        this.tableShow = false
                    }
                },
                "filter.endDate": {
                    handler: function() {
                        //選取其他月分的話，要同步 start&end
                        if(this.filter.endDate.slice(0,7) !== this.filter.month) {
                            this.filter.month = this.filter.endDate.slice(0,7)
                            this.filter.startDate = new Date(this.filter.month).Format('yyyy-MM-01')
                        }
                        this.form = {date: 0, employee_id: 0, type: ''}
                        this.tableShow = false
                    }
                },
                "form.type" : {
                    handler: function() {
                        this.addForm = {type: '0', over_time: 0, datetime: ''}
                        this.addCForm = {over_time: 0, datetime: ''}
                        // this.updateForm = {type: '0', over_time: 0, datetime: ''}
                        // this.updateCForm = {type: '0', over_time: 0, datetime: ''}
                    }
                }
            }
        })
    </script>
</body>
</html>